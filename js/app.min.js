const form=document.querySelector("form"),text=document.querySelector("input[type=text]"),number=document.querySelector("input[type=number]"),ignoreZwnjCheckbox=document.querySelector("#zwnj-checkbox"),tbody=document.querySelector("tbody"),messageContainer=document.querySelector("#message"),article=document.querySelector("article"),scriptWithBreakLinesContainer=document.querySelector("#script-with-breaklines"),minimumNumberOfLinesContainer=document.querySelector("#minimum-number-of-lines"),zwnj="‌",space=" ";form.addEventListener("submit",event=>{event.preventDefault();let script=text.value.trim().replace(/  +/g," ");const maximumCharactersPerLine=number.value;let minimumNumberOfLines=0,subScript="",subScriptLength=0,zwnjCounter=0,validationFlag=!0,scriptUpToTheFirstSpaceAfterZwnj="",scriptWithBreakLines="";if(article.classList.add("hidden"),script||maximumCharactersPerLine)if(script&&!maximumCharactersPerLine)writeMessage("Enter the maximum number of characters!");else if(!script&&maximumCharactersPerLine)writeMessage("Enter your script!");else{tbody.innerHTML="",tbody.classList.remove("bg-teal-800","bg-red-600","bg-gray-500");const scriptArray=script.split(" ");for(let i=0;i<scriptArray.length;i++){let word="";word=ignoreZwnjCheckbox.checked?scriptArray[i].replaceAll("‌",""):scriptArray[i],word.length>maximumCharactersPerLine&&(validationFlag=!1,writeMessage("You reached the character limit!"),tbody.classList.add("bg-red-600"),addSubScriptToTheTable("-",scriptArray[i],word.length))}if(validationFlag){tbody.classList.add("bg-teal-800"),script+=" ";for(let i=0;i<script.length;i++){let character=script[i];if(ignoreZwnjCheckbox.checked&&"‌"==character){zwnjCounter++;for(let j=i;j<script.length;j++)if(" "==script[j]){scriptUpToTheFirstSpaceAfterZwnj=script.substring(0,j);break}const scriptUpToTheFirstSpaceAfterZwnjRealLength=scriptUpToTheFirstSpaceAfterZwnj.replaceAll("‌","");scriptUpToTheFirstSpaceAfterZwnjRealLength.length>maximumCharactersPerLine&&(zwnjCounter--,scriptUpToTheFirstSpaceAfterZwnj="")}if(" "==character){const wordsWithoutTheLastSpace=script.substring(0,i),wordsWithTheLastSpace=script.substring(0,i+1);if(wordsWithTheLastSpace.length-zwnjCounter==maximumCharactersPerLine||wordsWithoutTheLastSpace.length-zwnjCounter==maximumCharactersPerLine)minimumNumberOfLines++,subScript=wordsWithoutTheLastSpace,subScriptLength=subScript.length-zwnjCounter,addSubScriptToTheTable(minimumNumberOfLines,subScript,subScriptLength),scriptWithBreakLines+=`<p class="h-6 flex justify-center items-center">${subScript}</p>`,script=script.substring(i+1,script.length),i=0,zwnjCounter=0;else if(wordsWithoutTheLastSpace.length-zwnjCounter>maximumCharactersPerLine){let index=-1;for(let j=0;j<wordsWithoutTheLastSpace.length;j++)" "==wordsWithoutTheLastSpace[j]&&(index=j);minimumNumberOfLines++,subScript=script.substring(0,index),subScriptLength=subScript.length-zwnjCounter,addSubScriptToTheTable(minimumNumberOfLines,subScript,subScriptLength),scriptWithBreakLines+=`<p class="h-6 flex justify-center items-center">${subScript}</p>`,script=script.substring(index+1,script.length),i=0,zwnjCounter=0}}i==script.length-1&&(minimumNumberOfLines++,subScript=script.trim(),0!=subScript.length&&(subScriptLength=subScript.length-zwnjCounter,addSubScriptToTheTable(minimumNumberOfLines,subScript,subScriptLength),scriptWithBreakLines+=`<p class="h-6 flex justify-center items-center">${subScript}</p>`))}}}else writeMessage("Fill both forms!");if(minimumNumberOfLines){writeMessage("Thank you for choosing Line Blaster!"),scriptWithBreakLinesContainer.innerHTML=scriptWithBreakLines,article.classList.remove("hidden");const minimumNumberOfLinesHexValue=1==minimumNumberOfLines.toString(16).length?`0${minimumNumberOfLines.toString(16)}`:minimumNumberOfLines.toString(16);minimumNumberOfLinesContainer.innerHTML=`Just <span class="cursor-pointer underline-offset-4 hover:underline" onclick="copy(this)" title="Copy">${minimumNumberOfLines}</span> (<span class="cursor-pointer underline-offset-4 hover:underline" onclick="copy(this)" title="Copy">${minimumNumberOfLinesHexValue}</span>) line${1==minimumNumberOfLines?"":"s"}!`}});const addSubScriptToTheTable=(lineNumber,subScript,subScriptLength)=>{const lineNumberIsNumber="number"==typeof lineNumber,lineNumberHexValue=lineNumberIsNumber&&1==lineNumber.toString(16).length?`0${lineNumber.toString(16)}`:lineNumber.toString(16);tbody.insertAdjacentHTML("beforeend",`<tr class="h-8 hover:bg-gray-500 transition-colors">\n    <td class="w-2/12 text-center border border-white overflow-auto">\n      <p class="whitespace-nowrap">\n        ${lineNumberIsNumber?"#":""}${lineNumberIsNumber?`<span class="cursor-pointer underline-offset-4 hover:underline" onclick="copy(this)" title="Copy">${lineNumber}</span>`:lineNumber} ${lineNumberIsNumber?`[<span class="cursor-pointer underline-offset-4 hover:underline" onclick="copy(this)" title="Copy">${lineNumberHexValue}</span>]`:""}\n      </p>\n    </td>\n    <td class="w-8/12 text-center border border-white hover:bg-gray-400 transition-colors overflow-auto cursor-pointer" onclick="copy(this)" title="Copy">\n      <p class="whitespace-nowrap">\n        ${subScript}\n      </p>\n    </td>\n    <td class="w-2/12 text-center border border-white overflow-auto">\n      <p class="whitespace-nowrap">\n        ${subScriptLength}\n      </p>\n    </td>\n  </tr>`)},copy=element=>{const text=element.textContent.trim();navigator.clipboard.writeText(text)},setPosition=element=>{element.style.left=`${Math.round(5*Math.random())}px`,element.style.top=`${Math.round(5*Math.random())}px`},writeMessage=message=>{messageContainer.classList.remove("opacity-100"),messageContainer.classList.add("opacity-0"),setTimeout(()=>{messageContainer.classList.remove("opacity-0"),messageContainer.classList.add("opacity-100"),messageContainer.textContent=message},500)};writeMessage("Start blasting the lines!");